--------------------------------------------------------------------------------
-- LISTAGG diff-export: one row per composite-key that has any column difference
-- Filters: ETL_BATCHID = '20251124'
--------------------------------------------------------------------------------
WITH
-- 1) normalized MAIN
main_norm AS (
  SELECT
    TRIM(TO_CHAR(JOB_APPLICATION))     AS JOB_APPLICATION,
    TRIM(TO_CHAR(CANDIDATE_ID))        AS CANDIDATE_ID,
    TRIM(TO_CHAR(POSITION))            AS POSITION,
    TRIM(TO_CHAR(EMPLOYEE_ID))         AS EMPLOYEE_ID,
    TRIM(TO_CHAR(SOEID))               AS SOEID,
    TRIM(TO_CHAR(JOB_REQUISITION))     AS JOB_REQUISITION,
    TRIM(TO_CHAR(ADDED_DATE,'YYYY-MM-DD HH24:MI:SS')) AS ADDED_DATE,
    TRIM(TO_CHAR(ORIGINAL_JOB_REQUISITION)) AS ORIGINAL_JOB_REQUISITION,
    TRIM(TO_CHAR(SOURCE_CATEGORY))    AS SOURCE_CATEGORY,
    TRIM(TO_CHAR(SOURCE))             AS SOURCE,
    TRIM(TO_CHAR(RECRUITING_AGENCY))  AS RECRUITING_AGENCY,
    TRIM(TO_CHAR(CANDIDATE_STATUS))   AS CANDIDATE_STATUS,
    TRIM(TO_CHAR(LAST_RECRUITING_STAGE))  AS LAST_RECRUITING_STAGE,
    TRIM(TO_CHAR(JOB_APPLICATION_STEP))   AS JOB_APPLICATION_STEP,
    TRIM(TO_CHAR(LAST_RECRUITING_STAGE_NUMBER)) AS LAST_RECRUITING_STAGE_NUMBER,
    TRIM(TO_CHAR(FINAL_DISPOSITION_REASON))     AS FINAL_DISPOSITION_REASON,
    TRIM(TO_CHAR(OFFER_STATUS))       AS OFFER_STATUS,
    TRIM(TO_CHAR(HIRED))              AS HIRED,
    TRIM(TO_CHAR(TIME_TO_OFFER_ACCEPT_DAYS)) AS TIME_TO_OFFER_ACCEPT_DAYS,
    TRIM(TO_CHAR(TIME_TO_OFFER_REJECT_DAYS)) AS TIME_TO_OFFER_REJECT_DAYS,
    TRIM(TO_CHAR(CANDIDATE_START_DATE,'YYYY-MM-DD HH24:MI:SS')) AS CANDIDATE_START_DATE,
    TRIM(TO_CHAR(REFERRED_BY))        AS REFERRED_BY,
    TRIM(TO_CHAR(CREATED_DATE,'YYYY-MM-DD HH24:MI:SS')) AS CREATED_DATE,
    TRIM(TO_CHAR(DATE_TIME_COMPLETED,'YYYY-MM-DD HH24:MI:SS')) AS DATE_TIME_COMPLETED,
    TRIM(TO_CHAR(UPDATED_BY))         AS UPDATED_BY,
    TRIM(TO_CHAR(UPDATED_ON,'YYYY-MM-DD HH24:MI:SS')) AS UPDATED_ON,
    TRIM(TO_CHAR(RECRUITER))          AS RECRUITER,
    TRIM(TO_CHAR(CANDIDATE_TAGS))     AS CANDIDATE_TAGS,
    TRIM(TO_CHAR(CANDIDATE_POOL))     AS CANDIDATE_POOL,
    TRIM(TO_CHAR(ETL_BATCHID))        AS ETL_BATCHID
  FROM WFA_APP_USR_TALD.WD_JOBAPPLICATION
  WHERE TRIM(TO_CHAR(ETL_BATCHID)) = '20251124'
),

-- 2) normalized TEMP
temp_norm AS (
  SELECT
    TRIM(TO_CHAR(JOB_APPLICATION))     AS JOB_APPLICATION,
    TRIM(TO_CHAR(CANDIDATE_ID))        AS CANDIDATE_ID,
    TRIM(TO_CHAR(POSITION))            AS POSITION,
    TRIM(TO_CHAR(EMPLOYEE_ID))         AS EMPLOYEE_ID,
    TRIM(TO_CHAR(SOEID))               AS SOEID,
    TRIM(TO_CHAR(JOB_REQUISITION))     AS JOB_REQUISITION,
    TRIM(TO_CHAR(ADDED_DATE,'YYYY-MM-DD HH24:MI:SS')) AS ADDED_DATE,
    TRIM(TO_CHAR(ORIGINAL_JOB_REQUISITION)) AS ORIGINAL_JOB_REQUISITION,
    TRIM(TO_CHAR(SOURCE_CATEGORY))    AS SOURCE_CATEGORY,
    TRIM(TO_CHAR(SOURCE))             AS SOURCE,
    TRIM(TO_CHAR(RECRUITING_AGENCY))  AS RECRUITING_AGENCY,
    TRIM(TO_CHAR(CANDIDATE_STATUS))   AS CANDIDATE_STATUS,
    TRIM(TO_CHAR(LAST_RECRUITING_STAGE))  AS LAST_RECRUITING_STAGE,
    TRIM(TO_CHAR(JOB_APPLICATION_STEP))   AS JOB_APPLICATION_STEP,
    TRIM(TO_CHAR(LAST_RECRUITING_STAGE_NUMBER)) AS LAST_RECRUITING_STAGE_NUMBER,
    TRIM(TO_CHAR(FINAL_DISPOSITION_REASON))     AS FINAL_DISPOSITION_REASON,
    TRIM(TO_CHAR(OFFER_STATUS))       AS OFFER_STATUS,
    TRIM(TO_CHAR(HIRED))              AS HIRED,
    TRIM(TO_CHAR(TIME_TO_OFFER_ACCEPT_DAYS)) AS TIME_TO_OFFER_ACCEPT_DAYS,
    TRIM(TO_CHAR(TIME_TO_OFFER_REJECT_DAYS)) AS TIME_TO_OFFER_REJECT_DAYS,
    TRIM(TO_CHAR(CANDIDATE_START_DATE,'YYYY-MM-DD HH24:MI:SS')) AS CANDIDATE_START_DATE,
    TRIM(TO_CHAR(REFERRED_BY))        AS REFERRED_BY,
    TRIM(TO_CHAR(CREATED_DATE,'YYYY-MM-DD HH24:MI:SS')) AS CREATED_DATE,
    TRIM(TO_CHAR(DATE_TIME_COMPLETED,'YYYY-MM-DD HH24:MI:SS')) AS DATE_TIME_COMPLETED,
    TRIM(TO_CHAR(UPDATED_BY))         AS UPDATED_BY,
    TRIM(TO_CHAR(UPDATED_ON,'YYYY-MM-DD HH24:MI:SS')) AS UPDATED_ON,
    TRIM(TO_CHAR(RECRUITER))          AS RECRUITER,
    TRIM(TO_CHAR(CANDIDATE_TAGS))     AS CANDIDATE_TAGS,
    TRIM(TO_CHAR(CANDIDATE_POOL))     AS CANDIDATE_POOL,
    TRIM(TO_CHAR(ETL_BATCHID))        AS ETL_BATCHID
  FROM WFA_APP_USR_TALD.WD_JOBAPPLICATION_TEMP
  WHERE TRIM(TO_CHAR(ETL_BATCHID)) = '20251124'
),

-- 3) join by composite key (one row per key match; if TEMP duplicates exist this will produce multiple rows for same MAIN key)
keyed_pairs AS (
  SELECT
    m.JOB_APPLICATION, m.CANDIDATE_ID, m.POSITION, m.EMPLOYEE_ID, m.SOEID, m.JOB_REQUISITION, m.ADDED_DATE,
    -- main side
    NVL(m.ORIGINAL_JOB_REQUISITION,'<NULL>')    AS MAIN_ORIGINAL_JOB_REQUISITION,
    NVL(m.SOURCE_CATEGORY,'<NULL>')             AS MAIN_SOURCE_CATEGORY,
    NVL(m.SOURCE,'<NULL>')                      AS MAIN_SOURCE,
    NVL(m.RECRUITING_AGENCY,'<NULL>')           AS MAIN_RECRUITING_AGENCY,
    NVL(m.CANDIDATE_STATUS,'<NULL>')            AS MAIN_CANDIDATE_STATUS,
    NVL(m.LAST_RECRUITING_STAGE,'<NULL>')       AS MAIN_LAST_RECRUITING_STAGE,
    NVL(m.JOB_APPLICATION_STEP,'<NULL>')        AS MAIN_JOB_APPLICATION_STEP,
    NVL(m.LAST_RECRUITING_STAGE_NUMBER,'<NULL>')AS MAIN_LAST_RECRUITING_STAGE_NUMBER,
    NVL(m.FINAL_DISPOSITION_REASON,'<NULL>')    AS MAIN_FINAL_DISPOSITION_REASON,
    NVL(m.OFFER_STATUS,'<NULL>')                AS MAIN_OFFER_STATUS,
    NVL(m.HIRED,'<NULL>')                       AS MAIN_HIRED,
    NVL(m.TIME_TO_OFFER_ACCEPT_DAYS,'<NULL>')   AS MAIN_TIME_TO_OFFER_ACCEPT_DAYS,
    NVL(m.TIME_TO_OFFER_REJECT_DAYS,'<NULL>')   AS MAIN_TIME_TO_OFFER_REJECT_DAYS,
    NVL(m.CANDIDATE_START_DATE,'<NULL>')        AS MAIN_CANDIDATE_START_DATE,
    NVL(m.REFERRED_BY,'<NULL>')                 AS MAIN_REFERRED_BY,
    NVL(m.CREATED_DATE,'<NULL>')                AS MAIN_CREATED_DATE,
    NVL(m.DATE_TIME_COMPLETED,'<NULL>')         AS MAIN_DATE_TIME_COMPLETED,
    NVL(m.UPDATED_BY,'<NULL>')                  AS MAIN_UPDATED_BY,
    NVL(m.UPDATED_ON,'<NULL>')                  AS MAIN_UPDATED_ON,
    NVL(m.RECRUITER,'<NULL>')                   AS MAIN_RECRUITER,
    NVL(m.CANDIDATE_TAGS,'<NULL>')              AS MAIN_CANDIDATE_TAGS,
    NVL(m.CANDIDATE_POOL,'<NULL>')              AS MAIN_CANDIDATE_POOL,
    NVL(m.ETL_BATCHID,'<NULL>')                 AS MAIN_ETL_BATCHID,
    -- temp side
    NVL(t.ORIGINAL_JOB_REQUISITION,'<NULL>')    AS TEMP_ORIGINAL_JOB_REQUISITION,
    NVL(t.SOURCE_CATEGORY,'<NULL>')             AS TEMP_SOURCE_CATEGORY,
    NVL(t.SOURCE,'<NULL>')                      AS TEMP_SOURCE,
    NVL(t.RECRUITING_AGENCY,'<NULL>')           AS TEMP_RECRUITING_AGENCY,
    NVL(t.CANDIDATE_STATUS,'<NULL>')            AS TEMP_CANDIDATE_STATUS,
    NVL(t.LAST_RECRUITING_STAGE,'<NULL>')       AS TEMP_LAST_RECRUITING_STAGE,
    NVL(t.JOB_APPLICATION_STEP,'<NULL>')        AS TEMP_JOB_APPLICATION_STEP,
    NVL(t.LAST_RECRUITING_STAGE_NUMBER,'<NULL>')AS TEMP_LAST_RECRUITING_STAGE_NUMBER,
    NVL(t.FINAL_DISPOSITION_REASON,'<NULL>')    AS TEMP_FINAL_DISPOSITION_REASON,
    NVL(t.OFFER_STATUS,'<NULL>')                AS TEMP_OFFER_STATUS,
    NVL(t.HIRED,'<NULL>')                       AS TEMP_HIRED,
    NVL(t.TIME_TO_OFFER_ACCEPT_DAYS,'<NULL>')   AS TEMP_TIME_TO_OFFER_ACCEPT_DAYS,
    NVL(t.TIME_TO_OFFER_REJECT_DAYS,'<NULL>')   AS TEMP_TIME_TO_OFFER_REJECT_DAYS,
    NVL(t.CANDIDATE_START_DATE,'<NULL>')        AS TEMP_CANDIDATE_START_DATE,
    NVL(t.REFERRED_BY,'<NULL>')                 AS TEMP_REFERRED_BY,
    NVL(t.CREATED_DATE,'<NULL>')                AS TEMP_CREATED_DATE,
    NVL(t.DATE_TIME_COMPLETED,'<NULL>')         AS TEMP_DATE_TIME_COMPLETED,
    NVL(t.UPDATED_BY,'<NULL>')                  AS TEMP_UPDATED_BY,
    NVL(t.UPDATED_ON,'<NULL>')                  AS TEMP_UPDATED_ON,
    NVL(t.RECRUITER,'<NULL>')                   AS TEMP_RECRUITER,
    NVL(t.CANDIDATE_TAGS,'<NULL>')              AS TEMP_CANDIDATE_TAGS,
    NVL(t.CANDIDATE_POOL,'<NULL>')              AS TEMP_CANDIDATE_POOL,
    NVL(t.ETL_BATCHID,'<NULL>')                 AS TEMP_ETL_BATCHID
  FROM main_norm m
  JOIN temp_norm t
    ON m.JOB_APPLICATION = t.JOB_APPLICATION
   AND m.CANDIDATE_ID    = t.CANDIDATE_ID
   AND m.POSITION        = t.POSITION
   AND m.EMPLOYEE_ID     = t.EMPLOYEE_ID
   AND m.SOEID           = t.SOEID
   AND m.JOB_REQUISITION = t.JOB_REQUISITION
   AND m.ADDED_DATE      = t.ADDED_DATE
),

-- 4) produce one row per differing column per key
per_col_diffs AS (
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'ORIGINAL_JOB_REQUISITION' AS col_name, MAIN_ORIGINAL_JOB_REQUISITION AS main_val, TEMP_ORIGINAL_JOB_REQUISITION AS temp_val
  FROM keyed_pairs WHERE MAIN_ORIGINAL_JOB_REQUISITION <> TEMP_ORIGINAL_JOB_REQUISITION

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'SOURCE_CATEGORY', MAIN_SOURCE_CATEGORY, TEMP_SOURCE_CATEGORY FROM keyed_pairs WHERE MAIN_SOURCE_CATEGORY <> TEMP_SOURCE_CATEGORY

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'SOURCE', MAIN_SOURCE, TEMP_SOURCE FROM keyed_pairs WHERE MAIN_SOURCE <> TEMP_SOURCE

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'RECRUITING_AGENCY', MAIN_RECRUITING_AGENCY, TEMP_RECRUITING_AGENCY FROM keyed_pairs WHERE MAIN_RECRUITING_AGENCY <> TEMP_RECRUITING_AGENCY

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'CANDIDATE_STATUS', MAIN_CANDIDATE_STATUS, TEMP_CANDIDATE_STATUS FROM keyed_pairs WHERE MAIN_CANDIDATE_STATUS <> TEMP_CANDIDATE_STATUS

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'LAST_RECRUITING_STAGE', MAIN_LAST_RECRUITING_STAGE, TEMP_LAST_RECRUITING_STAGE FROM keyed_pairs WHERE MAIN_LAST_RECRUITING_STAGE <> TEMP_LAST_RECRUITING_STAGE

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'JOB_APPLICATION_STEP', MAIN_JOB_APPLICATION_STEP, TEMP_JOB_APPLICATION_STEP FROM keyed_pairs WHERE MAIN_JOB_APPLICATION_STEP <> TEMP_JOB_APPLICATION_STEP

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'LAST_RECRUITING_STAGE_NUMBER', MAIN_LAST_RECRUITING_STAGE_NUMBER, TEMP_LAST_RECRUITING_STAGE_NUMBER FROM keyed_pairs WHERE MAIN_LAST_RECRUITING_STAGE_NUMBER <> TEMP_LAST_RECRUITING_STAGE_NUMBER

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'FINAL_DISPOSITION_REASON', MAIN_FINAL_DISPOSITION_REASON, TEMP_FINAL_DISPOSITION_REASON FROM keyed_pairs WHERE MAIN_FINAL_DISPOSITION_REASON <> TEMP_FINAL_DISPOSITION_REASON

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'OFFER_STATUS', MAIN_OFFER_STATUS, TEMP_OFFER_STATUS FROM keyed_pairs WHERE MAIN_OFFER_STATUS <> TEMP_OFFER_STATUS

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'HIRED', MAIN_HIRED, TEMP_HIRED FROM keyed_pairs WHERE MAIN_HIRED <> TEMP_HIRED

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'TIME_TO_OFFER_ACCEPT_DAYS', MAIN_TIME_TO_OFFER_ACCEPT_DAYS, TEMP_TIME_TO_OFFER_ACCEPT_DAYS FROM keyed_pairs WHERE MAIN_TIME_TO_OFFER_ACCEPT_DAYS <> TEMP_TIME_TO_OFFER_ACCEPT_DAYS

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'TIME_TO_OFFER_REJECT_DAYS', MAIN_TIME_TO_OFFER_REJECT_DAYS, TEMP_TIME_TO_OFFER_REJECT_DAYS FROM keyed_pairs WHERE MAIN_TIME_TO_OFFER_REJECT_DAYS <> TEMP_TIME_TO_OFFER_REJECT_DAYS

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'CANDIDATE_START_DATE', MAIN_CANDIDATE_START_DATE, TEMP_CANDIDATE_START_DATE FROM keyed_pairs WHERE MAIN_CANDIDATE_START_DATE <> TEMP_CANDIDATE_START_DATE

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'REFERRED_BY', MAIN_REFERRED_BY, TEMP_REFERRED_BY FROM keyed_pairs WHERE MAIN_REFERRED_BY <> TEMP_REFERRED_BY

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'CREATED_DATE', MAIN_CREATED_DATE, TEMP_CREATED_DATE FROM keyed_pairs WHERE MAIN_CREATED_DATE <> TEMP_CREATED_DATE

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'DATE_TIME_COMPLETED', MAIN_DATE_TIME_COMPLETED, TEMP_DATE_TIME_COMPLETED FROM keyed_pairs WHERE MAIN_DATE_TIME_COMPLETED <> TEMP_DATE_TIME_COMPLETED

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'UPDATED_BY', MAIN_UPDATED_BY, TEMP_UPDATED_BY FROM keyed_pairs WHERE MAIN_UPDATED_BY <> TEMP_UPDATED_BY

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'UPDATED_ON', MAIN_UPDATED_ON, TEMP_UPDATED_ON FROM keyed_pairs WHERE MAIN_UPDATED_ON <> TEMP_UPDATED_ON

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'RECRUITER', MAIN_RECRUITER, TEMP_RECRUITER FROM keyed_pairs WHERE MAIN_RECRUITER <> TEMP_RECRUITER

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'CANDIDATE_TAGS', MAIN_CANDIDATE_TAGS, TEMP_CANDIDATE_TAGS FROM keyed_pairs WHERE MAIN_CANDIDATE_TAGS <> TEMP_CANDIDATE_TAGS

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'CANDIDATE_POOL', MAIN_CANDIDATE_POOL, TEMP_CANDIDATE_POOL FROM keyed_pairs WHERE MAIN_CANDIDATE_POOL <> TEMP_CANDIDATE_POOL

  UNION ALL
  SELECT JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE,
         'ETL_BATCHID', MAIN_ETL_BATCHID, TEMP_ETL_BATCHID FROM keyed_pairs WHERE MAIN_ETL_BATCHID <> TEMP_ETL_BATCHID
)

-- 5) final aggregation: one row per key with LISTAGG of differing columns and values
SELECT
  JOB_APPLICATION,
  CANDIDATE_ID,
  POSITION,
  EMPLOYEE_ID,
  SOEID,
  JOB_REQUISITION,
  ADDED_DATE,
  COUNT(*) AS diff_count,
  LISTAGG(col_name, ', ') WITHIN GROUP (ORDER BY col_name) AS differing_columns,
  -- main side values like: "COL1=val; COL2=val; ..."
  LISTAGG(col_name || '=' || main_val, ' ; ') WITHIN GROUP (ORDER BY col_name) AS main_mismatch_vals,
  LISTAGG(col_name || '=' || temp_val, ' ; ') WITHIN GROUP (ORDER BY col_name) AS temp_mismatch_vals
FROM per_col_diffs
GROUP BY JOB_APPLICATION, CANDIDATE_ID, POSITION, EMPLOYEE_ID, SOEID, JOB_REQUISITION, ADDED_DATE
ORDER BY diff_count DESC, JOB_APPLICATION, CANDIDATE_ID;
