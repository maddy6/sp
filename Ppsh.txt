WITH main_hash AS (
    SELECT row_hash, COUNT(*) cnt
    FROM (
        SELECT
            STANDARD_HASH(
                STANDARD_HASH(ETL_BATCHID, 'SHA256') ||
                STANDARD_HASH(IDENTIFIER_POSITION_INCUMBENT_YEAR, 'SHA256') ||
                STANDARD_HASH(IDENTIFIER_SUCCESSOR_YEAR, 'SHA256') ||
                STANDARD_HASH(INCUMBENT, 'SHA256') ||
                STANDARD_HASH(INCUMBENT_GEID, 'SHA256') ||
                STANDARD_HASH(INCUMBENT_TALENT_POOL, 'SHA256') ||
                STANDARD_HASH(IS_SUCCESSOR_TOP_CANDIDATE, 'SHA256') ||
                STANDARD_HASH(NO_OF_SUCCESSORS, 'SHA256') ||
                STANDARD_HASH(POSITION, 'SHA256') ||
                STANDARD_HASH(SUCCESSION_PLAN_UPDATE_DATE, 'SHA256') ||
                STANDARD_HASH(SUCCESSION_PLAN_UPDATE_YEAR, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR, 'SHA256') ||
                STANDARD_HASH(DBMS_LOB.SUBSTR(SUCCESSORS_SUCCESSION_PLANS, 4000, 1), 'SHA256') ||
                STANDARD_HASH(DBMS_LOB.SUBSTR(SUCCESSOR_CAREER_INTERESTS, 4000, 1), 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_CAREER_PREFERENCES, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_GEID, 'SHA256') ||
                STANDARD_HASH(DBMS_LOB.SUBSTR(SUCCESSOR_JOB_INTERESTS, 4000, 1), 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_READINESS, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES_AREAS, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES_AREAS, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_TALENT_POOL, 'SHA256') ||
                STANDARD_HASH(TIME_ON_PLAN, 'SHA256'),
                'SHA256'
            ) AS row_hash
        FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN
    )
    GROUP BY row_hash
),
temp_hash AS (
    SELECT row_hash, COUNT(*) cnt
    FROM (
        SELECT
            STANDARD_HASH(
                STANDARD_HASH(ETL_BATCHID, 'SHA256') ||
                STANDARD_HASH(IDENTIFIER_POSITION_INCUMBENT_YEAR, 'SHA256') ||
                STANDARD_HASH(IDENTIFIER_SUCCESSOR_YEAR, 'SHA256') ||
                STANDARD_HASH(INCUMBENT, 'SHA256') ||
                STANDARD_HASH(INCUMBENT_GEID, 'SHA256') ||
                STANDARD_HASH(INCUMBENT_TALENT_POOL, 'SHA256') ||
                STANDARD_HASH(IS_SUCCESSOR_TOP_CANDIDATE, 'SHA256') ||
                STANDARD_HASH(NO_OF_SUCCESSORS, 'SHA256') ||
                STANDARD_HASH(POSITION, 'SHA256') ||
                STANDARD_HASH(SUCCESSION_PLAN_UPDATE_DATE, 'SHA256') ||
                STANDARD_HASH(SUCCESSION_PLAN_UPDATE_YEAR, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR, 'SHA256') ||
                STANDARD_HASH(DBMS_LOB.SUBSTR(SUCCESSORS_SUCCESSION_PLANS, 4000, 1), 'SHA256') ||
                STANDARD_HASH(DBMS_LOB.SUBSTR(SUCCESSOR_CAREER_INTERESTS, 4000, 1), 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_CAREER_PREFERENCES, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_GEID, 'SHA256') ||
                STANDARD_HASH(DBMS_LOB.SUBSTR(SUCCESSOR_JOB_INTERESTS, 4000, 1), 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_READINESS, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES_AREAS, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES_AREAS, 'SHA256') ||
                STANDARD_HASH(SUCCESSOR_TALENT_POOL, 'SHA256') ||
                STANDARD_HASH(TIME_ON_PLAN, 'SHA256'),
                'SHA256'
            ) AS row_hash
        FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN_TEMP
    )
    GROUP BY row_hash
)
SELECT
    NVL(m.row_hash, t.row_hash) AS row_hash,
    NVL(m.cnt, 0) AS main_count,
    NVL(t.cnt, 0) AS temp_count
FROM main_hash m
FULL OUTER JOIN temp_hash t
    ON m.row_hash = t.row_hash
WHERE NVL(m.cnt, 0) <> NVL(t.cnt, 0);



























WITH main_hash AS (
    SELECT
        STANDARD_HASH(
            ETL_BATCHID ||
            IDENTIFIER_POSITION_INCUMBENT_YEAR ||
            IDENTIFIER_SUCCESSOR_YEAR ||
            INCUMBENT ||
            INCUMBENT_GEID ||
            INCUMBENT_TALENT_POOL ||
            IS_SUCCESSOR_TOP_CANDIDATE ||
            NO_OF_SUCCESSORS ||
            POSITION ||
            SUCCESSION_PLAN_UPDATE_DATE ||
            SUCCESSION_PLAN_UPDATE_YEAR ||
            SUCCESSOR ||
            DBMS_LOB.SUBSTR(SUCCESSORS_SUCCESSION_PLANS, 4000, 1) ||
            DBMS_LOB.SUBSTR(SUCCESSOR_CAREER_INTERESTS, 4000, 1) ||
            SUCCESSOR_CAREER_PREFERENCES ||
            SUCCESSOR_GEID ||
            DBMS_LOB.SUBSTR(SUCCESSOR_JOB_INTERESTS, 4000, 1) ||
            SUCCESSOR_READINESS ||
            SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES ||
            SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES_AREAS ||
            SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES ||
            SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES_AREAS ||
            SUCCESSOR_TALENT_POOL ||
            TIME_ON_PLAN,
            'SHA256'
        ) AS row_hash,
        COUNT(*) cnt
    FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN
    GROUP BY
        STANDARD_HASH(
            ETL_BATCHID ||
            IDENTIFIER_POSITION_INCUMBENT_YEAR ||
            IDENTIFIER_SUCCESSOR_YEAR ||
            INCUMBENT ||
            INCUMBENT_GEID ||
            INCUMBENT_TALENT_POOL ||
            IS_SUCCESSOR_TOP_CANDIDATE ||
            NO_OF_SUCCESSORS ||
            POSITION ||
            SUCCESSION_PLAN_UPDATE_DATE ||
            SUCCESSION_PLAN_UPDATE_YEAR ||
            SUCCESSOR ||
            DBMS_LOB.SUBSTR(SUCCESSORS_SUCCESSION_PLANS, 4000, 1) ||
            DBMS_LOB.SUBSTR(SUCCESSOR_CAREER_INTERESTS, 4000, 1) ||
            SUCCESSOR_CAREER_PREFERENCES ||
            SUCCESSOR_GEID ||
            DBMS_LOB.SUBSTR(SUCCESSOR_JOB_INTERESTS, 4000, 1) ||
            SUCCESSOR_READINESS ||
            SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES ||
            SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES_AREAS ||
            SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES ||
            SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES_AREAS ||
            SUCCESSOR_TALENT_POOL ||
            TIME_ON_PLAN,
            'SHA256'
        )
),
temp_hash AS (
    SELECT
        STANDARD_HASH(
            ETL_BATCHID ||
            IDENTIFIER_POSITION_INCUMBENT_YEAR ||
            IDENTIFIER_SUCCESSOR_YEAR ||
            INCUMBENT ||
            INCUMBENT_GEID ||
            INCUMBENT_TALENT_POOL ||
            IS_SUCCESSOR_TOP_CANDIDATE ||
            NO_OF_SUCCESSORS ||
            POSITION ||
            SUCCESSION_PLAN_UPDATE_DATE ||
            SUCCESSION_PLAN_UPDATE_YEAR ||
            SUCCESSOR ||
            DBMS_LOB.SUBSTR(SUCCESSORS_SUCCESSION_PLANS, 4000, 1) ||
            DBMS_LOB.SUBSTR(SUCCESSOR_CAREER_INTERESTS, 4000, 1) ||
            SUCCESSOR_CAREER_PREFERENCES ||
            SUCCESSOR_GEID ||
            DBMS_LOB.SUBSTR(SUCCESSOR_JOB_INTERESTS, 4000, 1) ||
            SUCCESSOR_READINESS ||
            SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES ||
            SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES_AREAS ||
            SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES ||
            SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES_AREAS ||
            SUCCESSOR_TALENT_POOL ||
            TIME_ON_PLAN,
            'SHA256'
        ) AS row_hash,
        COUNT(*) cnt
    FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN_TEMP
    GROUP BY
        STANDARD_HASH(
            ETL_BATCHID ||
            IDENTIFIER_POSITION_INCUMBENT_YEAR ||
            IDENTIFIER_SUCCESSOR_YEAR ||
            INCUMBENT ||
            INCUMBENT_GEID ||
            INCUMBENT_TALENT_POOL ||
            IS_SUCCESSOR_TOP_CANDIDATE ||
            NO_OF_SUCCESSORS ||
            POSITION ||
            SUCCESSION_PLAN_UPDATE_DATE ||
            SUCCESSION_PLAN_UPDATE_YEAR ||
            SUCCESSOR ||
            DBMS_LOB.SUBSTR(SUCCESSORS_SUCCESSION_PLANS, 4000, 1) ||
            DBMS_LOB.SUBSTR(SUCCESSOR_CAREER_INTERESTS, 4000, 1) ||
            SUCCESSOR_CAREER_PREFERENCES ||
            SUCCESSOR_GEID ||
            DBMS_LOB.SUBSTR(SUCCESSOR_JOB_INTERESTS, 4000, 1) ||
            SUCCESSOR_READINESS ||
            SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES ||
            SUCCESSOR_RELOCATION_LONG_TERM_PREFERENCES_AREAS ||
            SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES ||
            SUCCESSOR_RELOCATION_SHORT_TERM_PREFERENCES_AREAS ||
            SUCCESSOR_TALENT_POOL ||
            TIME_ON_PLAN,
            'SHA256'
        )
)
SELECT
    NVL(m.row_hash, t.row_hash) AS row_hash,
    NVL(m.cnt, 0) AS main_count,
    NVL(t.cnt, 0) AS temp_count
FROM main_hash m
FULL OUTER JOIN temp_hash t
    ON m.row_hash = t.row_hash
WHERE NVL(m.cnt, 0) <> NVL(t.cnt, 0);


























SELECT 'MAIN_TABLE' AS table_name, COUNT(*) AS row_count
FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN
UNION ALL
SELECT 'TEMP_TABLE', COUNT(*)
FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN_TEMP;


SELECT 
    a.column_name,
    a.data_type   AS main_data_type,
    b.data_type   AS temp_data_type,
    CASE
        WHEN b.column_name IS NULL THEN 'MISSING_IN_TEMP'
        WHEN a.data_type <> b.data_type THEN 'DATA_TYPE_MISMATCH'
        ELSE 'MATCH'
    END AS status
FROM all_tab_columns a
LEFT JOIN all_tab_columns b
  ON a.column_name = b.column_name
 AND b.owner = 'WFA_APP_USR_TALD'
 AND b.table_name = 'WD_TALENT_MASTER_SUCCESSION_PLAN_TEMP'
WHERE a.owner = 'WFA_APP_USR_TALD'
  AND a.table_name = 'WD_TALENT_MASTER_SUCCESSION_PLAN'
ORDER BY status, a.column_name;



SELECT 
    b.column_name,
    'MISSING_IN_MAIN' AS status
FROM all_tab_columns b
LEFT JOIN all_tab_columns a
  ON a.column_name = b.column_name
 AND a.owner = 'WFA_APP_USR_TALD'
 AND a.table_name = 'WD_TALENT_MASTER_SUCCESSION_PLAN'
WHERE b.owner = 'WFA_APP_USR_TALD'
  AND b.table_name = 'WD_TALENT_MASTER_SUCCESSION_PLAN_TEMP'
  AND a.column_name IS NULL;



SELECT table_name, COUNT(*) AS column_count
FROM all_tab_columns
WHERE owner = 'WFA_APP_USR_TALD'
  AND table_name IN (
      'WD_TALENT_MASTER_SUCCESSION_PLAN',
      'WD_TALENT_MASTER_SUCCESSION_PLAN_TEMP'
  )
GROUP BY table_name;



4️⃣ Full Data Comparison (ALL COLUMNS, NO PRIMARY KEY)
4.1 Rows in MAIN but NOT in TEMP

SELECT *
FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN
MINUS
SELECT *
FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN_TEMP;


4.2 Rows in TEMP but NOT in MAIN

SELECT *
FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN_TEMP
MINUS
SELECT *
FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN;



5️⃣ Matching vs Non-Matching Row Counts (Summary)

SELECT 'ONLY_IN_MAIN' AS category, COUNT(*) cnt
FROM (
    SELECT *
    FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN
    MINUS
    SELECT *
    FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN_TEMP
)
UNION ALL
SELECT 'ONLY_IN_TEMP', COUNT(*)
FROM (
    SELECT *
    FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN_TEMP
    MINUS
    SELECT *
    FROM WFA_APP_USR_TALD.WD_TALENT_MASTER_SUCCESSION_PLAN
);





